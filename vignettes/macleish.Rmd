---
title: "Using the MacLeish Weather Data"
author: "Ben Baumer and Rose Goueth"
date: "12-16-2015"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using MacLeish Weather Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## Using the MacLeish Weather Data

This R package can be used to process and analyze data from the MacLeish weather station. The following text will give you an outline of how to use the package.

To start using the package, you need to run the following code:

```{r, message=FALSE}
library(macleish)
```

The data sets needed for this package already exists in the code. To explore the data, you can use the following tools:

Note that `head` and `tail` will give you the first (last) 6 readings from 2015, respectively.

```{r}
head(whately_2015)
tail(whately_2015)
```

## Analyzing the data:

Using plots can help you see your data visually. This is a good tool, especially if you want to find anomolies within the data. 

For example, the total rainfall measurement may be off because someone bumped into the instrument, or because it could have shut off by itself. So graphing this column of data would be of best interest. 

In order to find anomolies, you should plot the temperature against pressure.

```{r, fig.width = 7, fig.height = 5, message=FALSE}
library(ggplot2)
library(dplyr)
library(lubridate)
ggplot(data = whately_2015, aes(x = Press_mb_Avg, y = Temp_C_Avg)) +
  geom_point() + geom_smooth()
```



## Computing Daily averages

The following plot will show you how much rainfall you would have per day over the course of the data.

The "when" variable is used to plot the dates of each row of data. Since the data is updated very frequently, this plot will change on the rightmost side often throughtout the day.

```{r, fig.width = 7, fig.height = 5, message=FALSE}
daily <- whately_2015 %>%
  mutate(day_of_year = yday(when)) %>%
  group_by(day_of_year) %>%
  summarize(N = n(), avgRain = mean(Rain_mm_Tot))
ggplot(data = daily, aes(x = day_of_year, y = avgRain)) +
  geom_point()
```

These are some examples of you can explore and analyze data with this package.

## Temperature Trends

```{r, fig.width = 7, fig.height = 5, message=FALSE}
daily <- whately_2015 %>%
  mutate(day_of_year = yday(when)) %>%
  group_by(day_of_year) %>%
  summarize(N = n(), avgTemp = mean(Temp_C_Avg))
ggplot(data = daily, aes(x = day_of_year, y = avgTemp)) +
  geom_point() + geom_smooth()
```

#### Maps

```{r}
macleish <- data.frame( lon = -72.679389, lat = 42.449167)
```

```{r, fig.width=7, fig.height=7}
library(ggmap)
map <- ggmap(get_map(location = macleish, maptype = "terrain", zoom = 16))
library(broom)
buildings_tidy <- tidy(macleish_layers[["buildings"]])
map + geom_polygon(data = buildings_tidy, aes(x = long, y = lat, color = group))  
```


```{r, fig.width=7, fig.height=7}
library(leaflet)

forest_pal <- colorFactor("Greens", macleish_layers[["forests"]]$Sheet1__Na)

m <- leaflet() %>%
  addTiles() %>%
  # Boundaries
  addPolygons(data = macleish_layers[["macleish_boundary"]], weight = 1, fillOpacity = 0.01, group = "Boundaries") %>%
#  addPolygons(data = macleish_layers[["property_boundary"]], weight = 1, fill = "red", fillOpacity = 0.1) %>%
  # Man-Made structures
  addPolygons(data = macleish_layers[["buildings"]], 
              weight = 1, popup = ~ Feature, group = "Structures") %>%
#  addPolygons(data = macleish_layers[["reservoir"]], 
#              weight = 1, group = "Structures") %>%
  addMarkers(data = macleish_layers[["landmarks"]], 
             popup = ~ Label, group = "Structures") %>%
  addPolylines(data = macleish_layers[["trails"]], 
               weight = 1, color = "brown",
               popup = ~ Name, group = "Structures") %>%
  # Natural elements
  addPolygons(data = macleish_layers[["forests"]], 
              color = ~forest_pal(Sheet1__Na), weight = 0.1, 
              fillOpacity = 0.2,
              popup = ~ Sheet1__Na, group = "Natural") %>%
  addPolygons(data = macleish_layers[["vernal_pool"]], 
              fillOpacity = 0.02,
              weight = 0.1, group = "Natural") %>%
  addPolygons(data = macleish_layers[["wetlands"]], 
              weight = 1, group = "Natural") %>%
  addPolygons(data = macleish_layers[["slopes"]], 
              color = "darkgray", 
              weight = 1, group = "Natural") %>%
  addPolylines(data = macleish_layers[["streams"]], 
               weight = 2, group = "Natural") %>%
  # Layers control
  addLayersControl(
#    baseGroups = c("OSM (default)", "Toner", "Toner Lite"),
    overlayGroups = c("Boundaries", "Structures", "Natural"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  setView(lat = macleish$lat, lng = macleish$lon, zoom = 15)
m
```

