---
title: "Ada & Archibald MacLeish Field Station Data"
author: "Ben Baumer, Rose Goueth, Wencong Li (Priscilla) and Weijia Zhang (Vega), Paul Wetzel"
date: "04-10-2016"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using MacLeish Weather Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
library(knitr)
opts_chunk$set(fig.width = 6, fig.height = 4)
```


## Using the MacLeish Field Station Data
### This doucumentation is a recreation of the Macleish Field Station 2015 Weather Report 

You can download the orginal report as a PDF file from here: [MacLeish Field Station 2015 Weather Report](http://www.smith.edu/ceeds/documents/DataInformation2015.pdf)

## Introduction to Macleish Weather Stations
Weather conditions at Smith College’s Ada & Archibald MacLeish Field Station are recorded at the WhatelyMet weather station. This weather collection site is located at the end of Poplar Hill Road in Whately, Massachusetts, USA (Latitude 42 deg. 26 min. 56 sec. N Longitude 72 deg. 40 min. 50 sec. W). The meteorological instruments of WhatelyMet (except the rain gauge) are mounted at the top of a tower 25.3 m tall, well above the surrounding forest canopy. The tower is located on a local ridge at an elevation 250.75m above sea level.
The second weather data collection site, known as OrchardMet, is located about 250 m north of the first tower in an open field next to an apple orchard. Full canopy trees (~20 m tall) are within 30 m of this station. This station has a standard instrument configuration with temperature, relative humidity, solar radiation, and barometric pressure measured between 1.5 and 2.0 m above the ground. Wind speed and direction are measured on a 10 m tall tower and precipitation is measured on the ground. Ground temperature is measured at 15 and 30 cm below the ground surface 2 m south of the tower. The tower is located 258.1 m above sea level. Data collection at OrchardMet began on June 27th, 2014. 

This documentation describes the weather data collected at WhatelyMet and OrchardMet during 2015. It provides highlights of the year’s weather as well as general trends that were observed. We hope that you find the doucumentation both interesting and useful. All data reported in this document are available electronically. Please direct all questions and data inquiries to Paul Wetzel at pwetzel@smith.edu or telephone 413.585.2646.

This R package can be used to process and analyze data from [MacLeish Field Station](http://www.smith.edu/ceeds/macleish.php). The following text will give you an outline of how to use the package by showing demos of the 2015 weather data. 

## Variables used in this doucumentation:

* Temp_C_Avg: the average temperature (c)
* WSpd_mps: Average windspeed (mps)
* Wdir_deg: Wind direction (deg)
* RH_per_Avg: Relative Humidity (%)
* Press_mb_Avg: Average atomspheric pressure (mb)
* SlrW_Avg: Average Solar Radiance (W)
* Rain_mm_Tot: Main Rainfall amount per day (mm)

## Definitions of Climatic Indicators 
The precipitation and biological temperature indicators calculated for this doucumentation provide a method of comparing general, biologically meaningful climatic trends in di erent years. The indicators are based on average daily temperatures and rainfall summations. Even though days are in the name of the temperature indicators, they do not actually reflect periods of 24 hours. The indicators really measure the number of degrees the average temperature was above or below a threshold temperature each day of the year. These values are described at [Nelson Institute Center for Climate Research Webpage](http://ccr.aos.wisc.edu/climate_modeling/wisconsin_Climate/descriptions.php). All temperature terms were measured in degrees Celsius in this doucumentation. 

## Getting started:
To start using the package, you need to run the following code in order to load the `macleish` package in to your R session:

```{r, message=FALSE}
library(macleish)
```

A big part of this package is the macleish weather data. The first three examples will be based only on the macleish weather data. The data sets needed for this package already exists in the code. To explore the data, you can use the following tools:

Note that `head` and `tail` will give you the first (last) 6 readings from the whately weather station from 2015, respectively.

```{r}
head(whately_2015)
tail(whately_2015)
```

You can do the same thing for the orchard weather station and add one more statement in order to specify how many readings you want.

```{r}
head(orchard_2015,2)
tail(orchard_2015,2)
```


## Visualizing the data:
Plots can help you to visualize your data. They are helpful, especially if you want to find anomalies within the data. 

For example, the temperature recorder may be off because someone bumped into the instrument, or because it could have shut off by itself. So graphing this column of data would be of best interest. 

You need to use the following three packages in the following examples. 
```{r, message=FALSE}
library(ggplot2)
library(dplyr)
library(lubridate)
```


## Example 1: Air Temperature & Relative Humidity
In this example we are trying to visualize the trend of average daily temperature at macleish field station over 2015.

```{r, message=FALSE}
daily <- whately_2015 %>%
  mutate(day_of_year = yday(when)) %>%
  group_by(day_of_year) %>%
  summarize(N = n(), avgTemp = mean(Temp_C_Avg))
```

The following plot will show you the average daily temperature at macleish field station over 2015.

```{r, message=FALSE}
ggplot(data = daily, aes(x = day_of_year, y = avgTemp)) +
  geom_point() + geom_smooth()
```

The monthly average temperature in 2015 ranged from -6.4 °C in January to 21.6°C in July. The highest recorded temperature at WhatelyMet was 31.6 °C on July 23th. The lowest recorded temperature was -21.4 °C on January 6th. The average daily temperature range recorded from both stations (daily maximum-minimum) was -10.5 °C. The maximum daily temperature range was 20.8 °C at both stations but occurred on May 4th at OrchardMet and on May 8th at WhatleyMet. The daily minimum temperature range was 2.3 °C and occurred on January 26th. However daily temperature ranges of less than three degrees also occurred on February 9th, April 9th, June 1st and June 28th. 
Percent average monthly relative humidity ranged from 56.4% (March) to 94% (December). Interestingly, WhatelyMet relative humidity values were noteably higher than OrchardMet values starting in August. It is unclear why this pattern occurred during the last part of the year. 

## Example 3: Wind

Wind speed and direction is measured every second and then averaged and logged every 10 minutes at both weather stations. OrchardMet measures wind midway up the forest canopy (10 m high) in a small woodland clearing while WhatleyMet measures wind 25.3 m above the ground which is above the tree canopy.

#### orchard wind data summary

plot a windrose of orchard 2015 by showing the wind speed and direction for given facets using `clifro` and `ggplot2`
```{r, message=FALSE}
require(clifro)
wind.orchard<-orchard_2015 %>%
  select(when,WSpd_mps,Wdir_deg)
colnames(wind.orchard)[2]<-"wind_speeds"
colnames(wind.orchard)[3]<-"wind_dirs"
with(wind.orchard,windrose(wind_speeds,wind_dirs), ggtheme = "bw", col_pal = "Greys")
```

OrchardMet is located in a woodland clearing where winds are buffeted by trees of the forest canopy. Most wind comes from the west and southwest, with 67% of the time less than 1 m/s. Wind speeds did not average over 3 m/s at any time of the year. 

#### whately wind data summary

```{r, message=FALSE}
require(clifro)
wind.whately<-whately_2015 %>%
  select(when,WSpd_mps,Wdir_deg)
colnames(wind.whately)[2]<-"wind_speeds"
colnames(wind.whately)[3]<-"wind_dirs"
with(wind.whately,windrose(wind_speeds,wind_dirs),ggtheme = "bw", col_pal = "Greys")
```

WhatleyMet is above the forest canopy and recorded winds frequently from the northwest, west, and south during the year. Average wind velocities were higher, with 46% of the measurements falling between 1 and 2 m/s, with maximum average velocities up to 6 m/s. 



## Example 5: Precipitation
The "when" variable is used to plot the dates of each row of macleish weather data. Since the data is updated very frequently, it is very likely that more data will be plotted on the rightmost side of this plot everytime you run it.

First, we need to modify our data in order to have it in the form we want. Since the data was recorded every ten minutes, we need to group the data in respect to days in order to get the mean rainfall amount per day.

```{r, message=FALSE}
daily2015 <- whately_2015 %>%
  mutate(day_of_year = yday(when)) %>%
  group_by(day_of_year) %>%
  summarize(N = n(), avgRain = mean(Rain_mm_Tot))
```

Now, we can creat a xyplot to show how much rainfall you would have per day over the course of the whately_2015 weather data.

The following plot will show you how much rainfall you would have per day at macleish field station over 2015.

```{r, message=FALSE}
# daily precipitation
ggplot(data = daily2015, aes(x = day_of_year, y = avgRain)) +
  geom_bar(stat="identity")
# cumulative precipitation 
ggplot(daily2015,aes(x=day_of_year, y=cumsum(avgRain))) +geom_line()
```

A total of 1306 mm of precipitation was recorded at WhatelyMet during 2015. Although precipitation is relatively evenly distributed across the year, precipitation totals were highest in June and lowest in March. February and March had the greatest number of precipitation events . Annual precipitation accumulated at a low, but fairly steady rate through June. After June rainfall levels increased and total accumulation increased sharply to the end of the calendar year. Starting in June a series of large rainfall events (40-50 mm) occurred regularly over the summer. The largest precipitation event in 2015 occurred on September 30th when 113.8 mm (8.7% of the annual total) of precipitation fell. During 2015, there were 15, 25.4 mm (1”) precipitation events; 2, 50.8 mm (2”) precipitation events; and 1, 76.2 mm (3”) precipitation event. 



## Using the Macleish Field Station Geographic Data
## Example 6: Maps
We can use the `ggmap` package to display a map of macleish field station.

Here is the geographical location of macleish station.
```{r, message=FALSE}
macleish <- data.frame( lon = -72.679389, lat = 42.449167)
```

We can get a map of macleish field station by using the following command in the `ggmap` package.
```{r, message=FALSE}
library(ggmap)
map <- ggmap(get_map(location = macleish, maptype = "terrain", zoom = 16))
```

The  `tidy` command in the  `broom` package makes the building layer a data frame so that we can use `ggmap` to map the buildings on a static map.

```{r, message=FALSE}
library(broom)
buildings_tidy <- tidy(macleish_layers[["buildings"]])
```

Now, we can creat a map to show where are the buildings at macleish field station.

```{r, message=FALSE}
map + geom_polygon(data = buildings_tidy, aes(x = long, y = lat, color = group))  
```
